import{N as w,a as r,M as f,_ as p}from"./utils-oyCVUgbq.js";import{e as E,c as h,g as A,o as S,d as o,t as l,j as g,x as m,y as M,n as c}from"./vue-vendor-DhtqVHvN.js";const T=E({name:"AuthorizationModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"save",validator:s=>["save","salary"].includes(s)}},emits:["close","authorized"],components:{NotificationMessage:w},data(){return{password:"",isAuthorizing:!1,showPassword:!1,MESSAGES:f}},methods:{getButtonText(){return this.isAuthorizing?this.MESSAGES.AUTH_VERIFYING:this.mode==="salary"?this.MESSAGES.AUTH_BUTTON_SHOW_SALARY:this.MESSAGES.SAVE_CHANGES},async authorize(){if(!this.isAuthorizing){this.isAuthorizing=!0,this.showPassword=!1;try{if(!await this.verifyPassword()){r(this.MESSAGES.AUTH_INVALID_PASSWORD,"red"),this.password="";return}this.mode==="salary"?this.handleSalaryMode():await this.handleSaveMode()}catch(s){console.error(s),r(this.MESSAGES.AUTH_ERROR,"red")}finally{this.isAuthorizing=!1}}},async verifyPassword(){const s=new TextEncoder().encode("asmmRrfFvKrsBgyLzUuiZD9tGQj3LAQj"),t=1e5,a=32,i=new TextEncoder,n=await window.crypto.subtle.importKey("raw",i.encode(this.password),{name:"PBKDF2"},!1,["deriveBits"]),d=await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:s,iterations:t,hash:"SHA-256"},n,a*8);return Array.from(new Uint8Array(d)).map(y=>y.toString(16).padStart(2,"0")).join("")==="5fb04c8d929f687dd2baed132f66d67a8a442cab4d2d84cec4a58b08f01f9c6b"},handleSalaryMode(){r(this.MESSAGES.AUTH_ACCESS_GRANTED,"green"),this.$emit("authorized"),this.closeModal()},async handleSaveMode(){const s=this.collectSessionStorageData();if(Object.keys(s).length===0){r(this.MESSAGES.AUTH_NO_CHANGES_TO_SAVE,"yellow");return}await this.saveDataToServer(s),r(this.MESSAGES.AUTH_SAVE_SUCCESS,"green"),this.$emit("authorized"),this.closeModal()},collectSessionStorageData(){const s={};for(let t=0;t<sessionStorage.length;t++){const a=sessionStorage.key(t);if(a)try{const i=JSON.parse(sessionStorage.getItem(a)||"{}"),n={dayShift1:i.dayShift1??null,dayShift2:i.dayShift2??null,nightShift1:i.nightShift1??null,nightShift2:i.nightShift2??null};s[a]=n}catch{}}return s},async saveDataToServer(s){const t={};Object.entries(s).forEach(([d,e])=>{if(e){const u={dayShift1:e.dayShift1??null,dayShift2:e.dayShift2??null,nightShift1:e.nightShift1??null,nightShift2:e.nightShift2??null};t[d]=u}});const a=JSON.stringify(t),i=btoa(a),n=await fetch("https://mc.kot.li:8443/?key=shiftData.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"shiftData",value:i})});if(!n.ok)throw new Error(`Server error: ${n.status}`)},closeModal(){this.password="",this.$emit("close")},cancel(){this.isAuthorizing||this.closeModal()},togglePasswordVisibility(){this.showPassword=!this.showPassword}},mounted(){this.$nextTick(()=>{this.$refs.passwordInput?.focus()})}}),P={key:0,class:"modal"},b={class:"modal-content"},v={class:"input-container"},D=["type","placeholder"],H=["aria-label","title"],_={class:"eye-icon"},z={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"white","stroke-width":"2"},G={class:"button-container"},O=["disabled"],R={key:0,class:"spinner"},U=["disabled"];function k(s,t,a,i,n,d){return s.show?(S(),h("section",P,[o("div",b,[o("h3",null,l(s.MESSAGES.AUTH_TITLE),1),o("p",null,l(s.mode==="salary"?s.MESSAGES.AUTH_PROMPT_SALARY:s.MESSAGES.AUTH_PROMPT_SAVE),1),o("div",v,[g(o("input",{type:s.showPassword?"text":"password","onUpdate:modelValue":t[0]||(t[0]=e=>s.password=e),onKeyup:t[1]||(t[1]=M((...e)=>s.authorize&&s.authorize(...e),["enter"])),placeholder:s.MESSAGES.AUTH_PASSWORD_PLACEHOLDER,autocomplete:"current-password",ref:"passwordInput"},null,40,D),[[m,s.password]]),o("button",{type:"button",class:"toggle-password-button",onClick:t[2]||(t[2]=(...e)=>s.togglePasswordVisibility&&s.togglePasswordVisibility(...e)),"aria-label":s.showPassword?s.MESSAGES.AUTH_PASSWORD_HIDE_ARIA:s.MESSAGES.AUTH_PASSWORD_SHOW_ARIA,title:s.showPassword?s.MESSAGES.AUTH_PASSWORD_HIDE_ARIA:s.MESSAGES.AUTH_PASSWORD_SHOW_ARIA},[o("span",_,[(S(),h("svg",z,[o("g",{class:c({"eye-hidden":!s.showPassword})},t[5]||(t[5]=[o("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),o("circle",{cx:"12",cy:"12",r:"3"},null,-1)]),2),o("line",{class:c(["eye-slash",{"eye-slash-hidden":s.showPassword}]),x1:"2",y1:"2",x2:"22",y2:"22"},null,2)]))])],8,H)]),o("div",G,[o("button",{class:"primary-button",onClick:t[3]||(t[3]=(...e)=>s.authorize&&s.authorize(...e)),disabled:s.isAuthorizing},[o("span",null,l(s.getButtonText()),1),s.isAuthorizing?(S(),h("span",R)):A("",!0)],8,O),o("button",{class:"secondary-button",onClick:t[4]||(t[4]=(...e)=>s.cancel&&s.cancel(...e)),disabled:s.isAuthorizing},l(s.MESSAGES.CANCEL),9,U)])])])):A("",!0)}const I=p(T,[["render",k],["__scopeId","data-v-4c2d2d5f"]]);export{I as default};
