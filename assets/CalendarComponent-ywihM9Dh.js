import{c as k,i as T,a as D,s as m,d as u,b as G,h as P,l as p,g as w,e as $,v as F}from"./scrollUtils-CdeBdNu6.js";import{M as _,_ as E,N as H,c as O,S as L}from"./utils-DzzOqrFt.js";import{i as C}from"./index-GKILZaxe.js";import{c as l,o,t as d,w as S,n as f,l as N,g as R,d as a,T as W,h as M,i as B,F as y,a as I}from"./vue-vendor-DhtqVHvN.js";function Y(){return k(),{localData:{},madeChanges:!1}}const U={name:"CalendarShiftSlotComponent",emits:["drop","reset"],props:{day:{type:Object,required:!0},shiftType:{type:String,required:!0},isEditing:{type:Boolean,default:!1}},data(){return{MESSAGES:_}},computed:{isNightShift(){return this.shiftType.includes("night")},isDayShift(){return this.shiftType.includes("day")},shiftName(){return this.isDayShift?this.MESSAGES.SHIFT_DAY:this.MESSAGES.SHIFT_NIGHT},hasAssignedPerson(){return!!this.day[this.shiftType]},assignedPersonName(){return this.day[this.shiftType+"Name"]},isUserChanged(){return this.day[this.shiftType+"UserChanged"]},isRatownik(){return this.day[this.shiftType+"Ratownik"]===!0},isPielegniarka(){return this.day[this.shiftType+"Ratownik"]===!1}},methods:{getShiftSlotClasses(){return{day:this.isDayShift,night:this.isNightShift,ratownik:this.isRatownik,pielegniarka:this.isPielegniarka,userChanged:this.isUserChanged,clickable:this.isEditing&&this.hasAssignedPerson}},getShiftAriaLabel(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}. ${this.MESSAGES.SHIFT_CLICK_TO_REMOVE}.`:`${this.shiftName}: ${this.MESSAGES.SHIFT_EMPTY}. ${this.MESSAGES.SHIFT_DRAG_TO_ASSIGN}.`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${this.MESSAGES.SHIFT_EMPTY}.`},getShiftTooltip(){return this.isEditing?this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName} (${this.MESSAGES.SHIFT_CLICK_TO_DELETE})`:`${this.MESSAGES.SHIFT_DRAG_TO_ASSIGN_SPECIFIC} - ${this.shiftName.toLowerCase()}`:this.hasAssignedPerson?`${this.shiftName}: ${this.assignedPersonName}`:`${this.shiftName}: ${this.MESSAGES.NOT_ASSIGNED}`}}},q=["aria-label","title"],x={key:0,class:"assigned-person"},K={key:1,class:"assigned-person deleted"},V={key:2,class:"empty-slot"};function z(e,t,s,n,h,i){return o(),l("div",{class:f(["shift-slot",i.getShiftSlotClasses()]),onDragover:t[0]||(t[0]=S(()=>{},["prevent"])),onDrop:t[1]||(t[1]=c=>e.$emit("drop")),onClick:t[2]||(t[2]=c=>s.isEditing&&e.$emit("reset")),"aria-label":i.getShiftAriaLabel(),title:i.getShiftTooltip(),role:"button",tabindex:"0"},[s.day[s.shiftType]?(o(),l("div",x,d(s.day[s.shiftType+"Name"]),1)):s.day[s.shiftType+"UserChanged"]?(o(),l("div",K,d(h.MESSAGES.SHIFT_DELETED),1)):(o(),l("div",V,d(s.shiftType.includes("day")?h.MESSAGES.SHIFT_DAY_INITIAL:h.MESSAGES.SHIFT_NIGHT_INITIAL),1))],42,q)}const J=E(U,[["render",z],["__scopeId","data-v-9c6cdb14"]]),j={name:"MobileWarningModal",props:{show:{type:Boolean,required:!0}},emits:["close"],setup(){return{MESSAGES:_}}},X={key:0,class:"mobile-warning-overlay"},Q={class:"mobile-warning"};function Z(e,t,s,n,h,i){return o(),N(W,{to:"body"},[s.show?(o(),l("div",X,[a("div",Q,[a("h3",null,d(n.MESSAGES.MOBILE_WARNING_TITLE),1),a("p",null,d(n.MESSAGES.MOBILE_WARNING_TEXT),1),a("p",null,d(n.MESSAGES.MOBILE_WARNING_INSTRUCTION),1),a("button",{onClick:t[0]||(t[0]=c=>e.$emit("close")),class:"warning-button"},d(n.MESSAGES.MOBILE_WARNING_OK_BUTTON),1)])])):R("",!0)])}const ee=E(j,[["render",Z],["__scopeId","data-v-48e4ca99"]]),te={name:"CalendarComponent",emits:["update-editing-mode","has-changes","month-days-updated"],components:{NotificationMessage:H,ShiftSlot:J,MobileWarningModal:ee},props:{isEditingMode:{type:Boolean,required:!0},selectedMonth:{type:Number,required:!0},selectedYear:{type:Number,required:!0},people:{type:Array,required:!0}},data(){return{monthDays:[],localData:{},syncedChanges:{},daysOfWeek:u,currentDate:new Date,madeChanges:!1,scrollContainer:null,currentDropTarget:{date:null,shiftType:null},showMobileWarning:!1,isMobileDevice:!1,MESSAGES:_,SHIFT_TYPES:L}},computed:{holidayInfo(){return this.monthDays.map(e=>C(e.date))}},methods:{handleDrop(e,t){const s=this.getDraggedPersonFromStorage();if(!s)return;const n=this.findDayByDate(e);!n||!F(n,t,s,this.people)||(D(n,t,s),m(n),this.markChangesAndEmit(),this.clearDraggedPersonFromStorage())},handleClickResetShift(e,t){e[t]!==null&&($(e,t),m(e),this.madeChanges=!0,this.$emit("has-changes",!0))},generateMonthDays(){this.monthDays=w(this.selectedYear,this.selectedMonth),p(this.selectedYear,this.selectedMonth,this.monthDays,this.people),this.$emit("month-days-updated",this.monthDays)},updateChanges(e){this.madeChanges=e,this.$emit("has-changes",e)},emitEditingMode(e){this.$emit("update-editing-mode",e)},async checkShiftDataSync(){this.resetUserChanges(),this.syncedChanges=await O(()=>this.generateMonthDays())},loadFromSessionStorage(){p(this.selectedYear,this.selectedMonth,this.monthDays,this.people)},resetUserChanges(){const e=Y();this.localData=e.localData,this.madeChanges=e.madeChanges,this.$emit("has-changes",this.madeChanges)},handleScroll(e){P(e,this.scrollContainer)},scrollToToday(){this.$nextTick(()=>{const e=this.monthDays.findIndex(t=>T(t.date));G(this.scrollContainer,this.selectedMonth,this.selectedYear,e)})},getDayCellClasses(e){return{"current-month":e.isCurrentMonth,"nd-color":u[e.date.getDay()]==="Nd","sob-color":u[e.date.getDay()]==="Sob","holiday-color":this.isHoliday(e.date).isHoliday,today:this.isToday(e.date)}},getHolidayTooltip(e){return this.isHoliday(e).name||""},getDraggedPersonFromStorage(){const e=localStorage.getItem("draggedPerson");return e?JSON.parse(e):null},findDayByDate(e){return this.monthDays.find(t=>t.date.toDateString()===e.toDateString())},assignShiftToDay(e,t,s){D(e,t,s),m.call(this,e)},markChangesAndEmit(){this.madeChanges=!0,this.$emit("has-changes",!0)},clearDraggedPersonFromStorage(){localStorage.removeItem("draggedPerson")},checkMobilePlatform(){const e=navigator.userAgent||navigator.vendor;this.isMobileDevice=/android|iphone|ipad|ipod/i.test(e.toLowerCase())},handleMobileWarningClose(){this.showMobileWarning=!1,this.emitEditingMode(!1)},isToday(e){return T(e)},isHoliday(e){return C(e)}},async mounted(){this.resetUserChanges(),await this.checkShiftDataSync(),this.scrollContainer=this.$refs.scrollContainer,this.scrollToToday(),this.checkMobilePlatform()},watch:{isEditingMode(e){localStorage.setItem("isEditingMode",JSON.stringify(e)),e&&this.isMobileDevice&&(this.showMobileWarning=!0)},selectedMonth(){this.generateMonthDays(),this.scrollToToday()},selectedYear(){this.generateMonthDays()}}},se={class:"calendar-container"},ie={class:"calendar-grid"},ae=["title"],ne={class:"day-header"},oe={class:"day-date"};function re(e,t,s,n,h,i){const c=M("mobile-warning-modal"),A=M("shift-slot");return o(),l(y,null,[B(c,{show:h.showMobileWarning,onClose:i.handleMobileWarningClose},null,8,["show","onClose"]),a("div",se,[a("section",{class:"scrollable-container",onWheel:t[2]||(t[2]=S((...r)=>i.handleScroll&&i.handleScroll(...r),["prevent"])),ref:"scrollContainer"},[a("div",ie,[(o(!0),l(y,null,I(h.monthDays,(r,v)=>(o(),l("div",{key:v,class:f([{"today-column":i.isToday(r.date)},"day-column"]),onDragover:t[1]||(t[1]=S(()=>{},["prevent"]))},[a("div",null,[a("div",{class:f(["day-cell",i.getDayCellClasses(r)]),title:i.getHolidayTooltip(r.date)},[a("div",ne,d(h.daysOfWeek[r.date.getDay()]),1),a("div",{class:"shift",onDragover:t[0]||(t[0]=S(()=>{},["prevent"]))},[a("div",oe,d(r.date.getDate()),1),(o(!0),l(y,null,I(h.SHIFT_TYPES,g=>(o(),N(A,{key:g,day:r,"shift-type":g,"is-editing":s.isEditingMode,onDrop:b=>i.handleDrop(r.date,g),onReset:b=>i.handleClickResetShift(r,g)},null,8,["day","shift-type","is-editing","onDrop","onReset"]))),128))],32)],10,ae)])],34))),128))])],544)])],64)}const ge=E(te,[["render",re],["__scopeId","data-v-4a561b37"]]);export{ge as default};
