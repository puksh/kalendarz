import{N as w,a as r,M as y,_ as E}from"./utils-aRMUKmhZ.js";import{e as p,c as d,g as c,o as h,d as e,t as l,w as g,v as f,u as m,n as A}from"./vue-vendor-BgZW6MSE.js";import"./data-rJbXcCzs.js";const M=p({name:"AuthorizationModal",props:{show:{type:Boolean,required:!0},mode:{type:String,default:"save",validator:s=>["save","salary"].includes(s)}},emits:["close","authorized"],components:{NotificationMessage:w},data(){return{password:"",isAuthorizing:!1,showPassword:!1,MESSAGES:y}},methods:{getButtonText(){return this.isAuthorizing?this.MESSAGES.AUTH_VERIFYING:this.mode==="salary"?this.MESSAGES.AUTH_BUTTON_SHOW_SALARY:this.MESSAGES.SAVE_CHANGES},async authorize(){if(!this.isAuthorizing){this.isAuthorizing=!0,this.showPassword=!1;try{if(!await this.verifyPassword()){r(this.MESSAGES.AUTH_INVALID_PASSWORD,"red"),this.password="";return}this.mode==="salary"?this.handleSalaryMode():await this.handleSaveMode()}catch(s){console.error(s),r(this.MESSAGES.AUTH_ERROR,"red")}finally{this.isAuthorizing=!1}}},async verifyPassword(){const s=new TextEncoder().encode("asmmRrfFvKrsBgyLzUuiZD9tGQj3LAQj"),t=1e5,a=32,i=new TextEncoder,n=await window.crypto.subtle.importKey("raw",i.encode(this.password),{name:"PBKDF2"},!1,["deriveBits"]),S=await window.crypto.subtle.deriveBits({name:"PBKDF2",salt:s,iterations:t,hash:"SHA-256"},n,a*8);return Array.from(new Uint8Array(S)).map(u=>u.toString(16).padStart(2,"0")).join("")==="5fb04c8d929f687dd2baed132f66d67a8a442cab4d2d84cec4a58b08f01f9c6b"},handleSalaryMode(){r(this.MESSAGES.AUTH_ACCESS_GRANTED,"green"),this.$emit("authorized"),this.closeModal()},async handleSaveMode(){const s=this.collectSessionStorageData();if(Object.keys(s).length===0){r(this.MESSAGES.AUTH_NO_CHANGES_TO_SAVE,"yellow");return}await this.saveDataLocally(s),r(this.MESSAGES.AUTH_SAVE_SUCCESS,"green"),this.$emit("authorized"),this.closeModal()},collectSessionStorageData(){const s={};for(let t=0;t<sessionStorage.length;t++){const a=sessionStorage.key(t);if(a)try{const i=JSON.parse(sessionStorage.getItem(a)||"{}"),n={dayShift1:i.dayShift1??null,dayShift2:i.dayShift2??null,nightShift1:i.nightShift1??null,nightShift2:i.nightShift2??null};s[a]=n}catch{}}return s},async saveDataLocally(s){try{console.log("Data saved locally to sessionStorage:",Object.keys(s).length,"entries"),Object.entries(s).forEach(([t,a])=>{localStorage.setItem(`shift_${t}`,JSON.stringify(a))})}catch(t){throw console.error("Error saving data locally:",t),new Error("Błąd podczas zapisywania danych lokalnie")}},closeModal(){this.password="",this.$emit("close")},cancel(){this.isAuthorizing||this.closeModal()},togglePasswordVisibility(){this.showPassword=!this.showPassword}},mounted(){this.$nextTick(()=>{this.$refs.passwordInput?.focus()})}}),b={key:0,class:"modal"},P={class:"modal-content"},T={class:"input-container"},v=["type","placeholder"],H=["aria-label","title"],_={class:"eye-icon"},D={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"22",height:"22",fill:"none",stroke:"white","stroke-width":"2"},z={class:"button-container"},G=["disabled"],O={key:0,class:"spinner"},R=["disabled"];function U(s,t,a,i,n,S){return s.show?(h(),d("section",b,[e("div",P,[e("h3",null,l(s.MESSAGES.AUTH_TITLE),1),e("p",null,l(s.mode==="salary"?s.MESSAGES.AUTH_PROMPT_SALARY:s.MESSAGES.AUTH_PROMPT_SAVE),1),e("div",T,[g(e("input",{type:s.showPassword?"text":"password","onUpdate:modelValue":t[0]||(t[0]=o=>s.password=o),onKeyup:t[1]||(t[1]=m((...o)=>s.authorize&&s.authorize(...o),["enter"])),placeholder:s.MESSAGES.AUTH_PASSWORD_PLACEHOLDER,autocomplete:"current-password",ref:"passwordInput"},null,40,v),[[f,s.password]]),e("button",{type:"button",class:"toggle-password-button",onClick:t[2]||(t[2]=(...o)=>s.togglePasswordVisibility&&s.togglePasswordVisibility(...o)),"aria-label":s.showPassword?s.MESSAGES.AUTH_PASSWORD_HIDE_ARIA:s.MESSAGES.AUTH_PASSWORD_SHOW_ARIA,title:s.showPassword?s.MESSAGES.AUTH_PASSWORD_HIDE_ARIA:s.MESSAGES.AUTH_PASSWORD_SHOW_ARIA},[e("span",_,[(h(),d("svg",D,[e("g",{class:A({"eye-hidden":!s.showPassword})},t[5]||(t[5]=[e("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]),2),e("line",{class:A(["eye-slash",{"eye-slash-hidden":s.showPassword}]),x1:"2",y1:"2",x2:"22",y2:"22"},null,2)]))])],8,H)]),e("div",z,[e("button",{class:"primary-button",onClick:t[3]||(t[3]=(...o)=>s.authorize&&s.authorize(...o)),disabled:s.isAuthorizing},[e("span",null,l(s.getButtonText()),1),s.isAuthorizing?(h(),d("span",O)):c("",!0)],8,G),e("button",{class:"secondary-button",onClick:t[4]||(t[4]=(...o)=>s.cancel&&s.cancel(...o)),disabled:s.isAuthorizing},l(s.MESSAGES.CANCEL),9,R)])])])):c("",!0)}const N=E(M,[["render",U],["__scopeId","data-v-0d125bab"]]);export{N as default};
